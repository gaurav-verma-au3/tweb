const __vite__fileDeps=["./pageSignIn-rbSG92e7.js","./index-BpkmQJ7B.js","./index-dzKQggTO.css","./putPreloader-diAA0Z4w.js","./page-DRs10BYM.js","./countryInputField-DnVrcaQU.js","./button-CIRTFHo6.js","./wrapEmojiText-DlCOpVys.js","./scrollable-C_2j_KpO.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-BqER1AUU.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-Dji0D0b9.js","./pagePassword-BqsS4l1G.js","./htmlToSpan-Co5MHt__.js","./loginPage-B5Tviue5.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as u,l as H,a as l,d as F,e as z,i as N,_ as y,A as C,p as R}from"./index-BpkmQJ7B.js";import{a as j,P as W}from"./page-DRs10BYM.js";import{B as A}from"./button-CIRTFHo6.js";import{p as I}from"./putPreloader-diAA0Z4w.js";import{b as K,t as G}from"./textToSvgURL-Cnw_Q8Rw.js";let x=!1;function J(){return b||(b=l.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==u.lastRequestedLangCode?Promise.all([e,u.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),u.getCacheLangPack()]):[]))}let b;function X(e){x||J().then(([a,c])=>{if(!a)return;const i=[];c.forEach(s=>{const p=u.strings.get(s.key);p&&(i.push(p),u.strings.set(s.key,s))});const o="Login.ContinueOnLanguage",r=A("btn-primary btn-secondary btn-primary-transparent primary",{text:o});r.lastElementChild.classList.remove("i18n"),H({text:[u.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(r)})}),l.addEventListener("language_change",()=>{r.remove()},{once:!0}),i.forEach(s=>{u.strings.set(s.key,s)}),j(r,s=>{F(s),x=!0,r.disabled=!0,I(r),u.getLangPack(a.suggested_lang_code)})})}function Y(e,a){return a?e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""):e.replace(/-/g,"+").replace(/_/g,"/")}function Z(e){let a,c="";for(let i=e.length,o=0,r=0;r<i;++r)a=r%3,o|=e[r]<<(16>>>a&24),(a===2||i-r===1)&&(c+=String.fromCharCode(L(o>>>18&63),L(o>>>12&63),L(o>>>6&63),L(o&63)),o=0);return c.replace(/A(?=A$|$)/g,"=")}function L(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}const O=3,U=async()=>{const a=q.pageEl.querySelector(".auth-image");let c=I(a,!0);const i=document.createElement("div");i.classList.add("input-wrapper");const o=document.createElement("div");o.innerHTML=`<span>To use our service, you need an active Telegram account. If you don't have one, download the<a href="https://play.google.com/store/apps/details?id=org.telegram.messenger&amp;hl=en&amp;gl=US" target="_blank" rel="noopener noreferrer"> Telegram app </a>from your app store and create an account first</span>`;const r=A("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});i.append(r,o),X(i);const s=a.parentElement,p=document.createElement("div");p.classList.add("flex-div-title-container");const E=new Image;E.classList.add("tg-logo-small-inline"),E.src="https://i.ibb.co/HnLSvKn/square.png",p.append(E);const v=document.createElement("h4");v.classList.add("no-margin"),z(v,"Login.QR.Title"),p.append(v);const w=document.createElement("ol");w.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(d=>{const t=document.createElement("li");t.append(N(d)),w.append(t)}),s.append(p,w,i),r.addEventListener("click",()=>{y(()=>import("./pageSignIn-rbSG92e7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(d=>d.default.mount()),m=!0});const M=(await Promise.all([y(()=>import("./qr-code-styling-BqER1AUU.js").then(d=>d.q),__vite__mapDeps([10,11]),import.meta.url)]))[0].default;let m=!1;l.addEventListener("user_auth",()=>{m=!0,h=null},{once:!0});const k={ignoreErrors:!0};let S;const B=async d=>{try{let t=await l.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:C.id,api_hash:C.hash,except_ids:[]},{ignoreErrors:!0});if(t._==="auth.loginTokenMigrateTo"&&(k.dcId||(k.dcId=t.dc_id,l.managers.apiManager.setBaseDcId(t.dc_id)),t=await l.managers.apiManager.invokeApi("auth.importLoginToken",{token:t.token},k)),t._==="auth.loginTokenSuccess"){const g=t.authorization;return await l.managers.apiManager.setUser(g.user),y(()=>import("./pageIm-Dji0D0b9.js"),__vite__mapDeps([12,1,2,4]),import.meta.url).then(f=>f.default.mount()),!0}if(!S||!K(S,t.token)){S=t.token;const g=Z(t.token),f="tg://login?token="+Y(g,!0),T=window.getComputedStyle(document.documentElement),D=T.getPropertyValue("--surface-color").trim(),Q=T.getPropertyValue("--primary-text-color").trim(),V=T.getPropertyValue("--primary-color").trim(),$=await fetch("assets/img/logo_padded.svg").then(n=>n.text()).then(n=>(n=n.replace(/(fill:).+?(;)/,`$1${V}$2`),G(n))),_=new M({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:f,image:$,dotsOptions:{color:Q,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:D},qrOptions:{errorCorrectionLevel:"L"}});_.append(a),a.lastChild.classList.add("qr-canvas");let P;_._drawingPromise?P=_._drawingPromise:P=Promise.race([R(1e3),new Promise(n=>{_._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>n())},{once:!0})})]),await P.then(()=>{if(c){c.style.animation="hide-icon .4s forwards";const n=a.children[1];n.style.display="none",n.style.animation="grow-icon .4s forwards",setTimeout(()=>{n.style.display=""},150),setTimeout(()=>{n.style.animation=""},500),c=void 0}else Array.from(a.children).slice(0,-1).forEach(n=>{n.remove()})})}if(d){const g=Date.now()/1e3,f=t.expires-g-await l.managers.timeManager.getServerTimeOffset();await R(f>O?1e3*O:1e3*f|0)}}catch(t){switch(t.type){case"SESSION_PASSWORD_NEEDED":t.handled=!0,y(()=>import("./pagePassword-BqsS4l1G.js"),__vite__mapDeps([13,1,2,3,4,6,14,7,15]),import.meta.url).then(g=>g.default.mount()),m=!0,h=null;break;default:console.error("pageSignQR: default error:",t),m=!0;break}return!0}return!1};return async()=>{m=!1;do if(m||await B(!0))break;while(!0)}};let h;const q=new W("page-signQR",!0,()=>h,()=>{h||(h=U()),h.then(e=>{e()}),l.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),ie=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));export{ie as a,X as g,q as p};
//# sourceMappingURL=pageSignQR-BG_3gzlZ.js.map
